<?xml version="1.0" encoding="UTF-8"?>

<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
<xsl:output method="text"/>

<xsl:template match="/">

<xsl:text>
:: StoryTitle
My Story


:: StoryData
{
  "ifid": "649AB536-20DE-4D3D-BAF5-544D2ED975F6",
  "format": "Chapbook",
  "format-version": "1.2.3",
  "start": "Title Page",
  "zoom": 1
}

:: Title Page
config.body.transition.name: "fadeInOut"
config.body.transition.duration: "2000ms"
config.style.page.font: "Iowan Old Style/Constantia/Georgia/serif 18"
config.style.page.color: "gray-9 on white"
config.style.page.link.font: "underline"
config.style.page.link.color: "blue-6"
config.style.page.link.lineColor: "blue-6"
config.style.page.link.active.color: "blue-6"
config.style.page.header.font: "18"
config.style.page.header.link.font: "small caps"
config.style.page.footer.font: "16"
config.style.page.footer.link.font: "small caps"
--
[[WELCOME|Introducing Protagonist's Daily Life]]

</xsl:text>

    <xsl:for-each select="//sequence">
        <xsl:text>:: </xsl:text>
        <xsl:value-of select="@name"/>
        <xsl:text>

</xsl:text>
        <xsl:value-of select="normalize-space(outline)"/>
    <xsl:choose>
        <!-- Check the next sequence in the current part -->
        <xsl:when test="following-sibling::sequence[1]">
            <xsl:text>

[[next page.|</xsl:text>
            <xsl:value-of select="following-sibling::sequence[1]/@name"/>
            <xsl:text>]]

</xsl:text>
        </xsl:when>
        
        <!-- Check the next sequence in the current act -->
        <xsl:when test="parent::part/following-sibling::part[1]/sequence[1]">
            <xsl:text>

[[next page.|</xsl:text>
            <xsl:value-of select="parent::part/following-sibling::part[1]/sequence[1]/@name"/>
            <xsl:text>]]

</xsl:text>
        </xsl:when>

        <!-- Check the next sequence in the next act -->
        <xsl:when test="parent::act/following-sibling::act[1]/part[1]/sequence[1]">
            <xsl:text>

[[next page.|</xsl:text>
            <xsl:value-of select="ancestor::act/following-sibling::act[1]/part[1]/sequence[1]/@nam"/>
            <xsl:text>]]

</xsl:text>
        </xsl:when>
        <xsl:otherwise>
        <xsl:text>
The End!</xsl:text>    
        </xsl:otherwise>
    </xsl:choose>

    </xsl:for-each>

</xsl:template>

</xsl:stylesheet>